var G=Object.defineProperty;var f=(e,t)=>{for(var n in t)G(e,n,{get:t[n],enumerable:!0})};var p=e=>{throw new Error("Not initialized yet")},v=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var x=new Map,y=0;v&&(globalThis.syscall=async(e,...t)=>await new Promise((n,o)=>{y++,x.set(y,{resolve:n,reject:o}),p({type:"sys",id:y,name:e,args:t})}));function w(e,t,n){v&&(p=n,self.addEventListener("message",o=>{(async()=>{let i=o.data;switch(i.type){case"inv":{let d=e[i.name];if(!d)throw new Error(`Function not loaded: ${i.name}`);try{let s=await Promise.resolve(d(...i.args||[]));p({type:"invr",id:i.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",i.name,"error:",s.message),p({type:"invr",id:i.id,error:s.message})}}break;case"sysr":{let d=i.id,s=x.get(d);if(!s)throw Error("Invalid request id");x.delete(d),i.error?s.reject(new Error(i.error)):s.resolve(i.result)}break}})().catch(console.error)}),p({type:"manifest",manifest:t}))}function S(e){let t=atob(e),n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o}function A(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",n=e.byteLength;for(let o=0;o<n;o++)t+=String.fromCharCode(e[o]);return btoa(t)}async function W(e,t){if(typeof e!="string"){let n=new Uint8Array(await e.arrayBuffer()),o=n.length>0?A(n):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:o},e=e.url}return syscall("sandboxFetch.fetch",e,t)}globalThis.nativeFetch=globalThis.fetch;function U(){globalThis.fetch=async function(e,t){let n=t&&t.body?A(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,o=await W(e,t&&{method:t.method,headers:t.headers,base64Body:n});return new Response(o.base64Body?S(o.base64Body):null,{status:o.status,headers:o.headers})}}v&&U();var a={};f(a,{confirm:()=>ce,copyToClipboard:()=>ve,deleteLine:()=>be,dispatch:()=>se,downloadFile:()=>Q,filterBox:()=>q,flashNotification:()=>$,fold:()=>ue,foldAll:()=>fe,getCurrentPage:()=>F,getCursor:()=>k,getSelection:()=>L,getText:()=>R,getUiOption:()=>de,goHistory:()=>X,hidePanel:()=>ee,insertAtCursor:()=>ie,insertAtPos:()=>te,moveCursor:()=>ne,moveCursorToLine:()=>oe,navigate:()=>O,newWindow:()=>J,openCommandPalette:()=>V,openPageNavigator:()=>j,openSearchPanel:()=>xe,openUrl:()=>D,prompt:()=>ae,redo:()=>ye,reloadConfigAndCommands:()=>N,reloadPage:()=>Y,reloadUI:()=>H,replaceRange:()=>re,save:()=>E,setSelection:()=>K,setText:()=>T,setUiOption:()=>le,showPanel:()=>_,toggleFold:()=>me,undo:()=>he,unfold:()=>pe,unfoldAll:()=>ge,uploadFile:()=>z,vimEx:()=>we});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function r(e,...t){return globalThis.syscall(e,...t)}function F(){return r("editor.getCurrentPage")}function R(){return r("editor.getText")}function T(e,t=!1){return r("editor.setText",e,t)}function k(){return r("editor.getCursor")}function L(){return r("editor.getSelection")}function K(e,t){return r("editor.setSelection",e,t)}function E(){return r("editor.save")}function O(e,t=!1,n=!1){return r("editor.navigate",e,t,n)}function j(e="page"){return r("editor.openPageNavigator",e)}function V(){return r("editor.openCommandPalette")}function Y(){return r("editor.reloadPage")}function H(){return r("editor.reloadUI")}function N(){return r("editor.reloadConfigAndCommands")}function D(e,t=!1){return r("editor.openUrl",e,t)}function J(){return r("editor.newWindow")}function X(e){return r("editor.goHistory",e)}function Q(e,t){return r("editor.downloadFile",e,t)}function z(e,t){return r("editor.uploadFile",e,t)}function $(e,t="info"){return r("editor.flashNotification",e,t)}function q(e,t,n="",o=""){return r("editor.filterBox",e,t,n,o)}function _(e,t,n,o=""){return r("editor.showPanel",e,t,n,o)}function ee(e){return r("editor.hidePanel",e)}function te(e,t){return r("editor.insertAtPos",e,t)}function re(e,t,n){return r("editor.replaceRange",e,t,n)}function ne(e,t=!1){return r("editor.moveCursor",e,t)}function oe(e,t=1,n=!1){return r("editor.moveCursorToLine",e,t,n)}function ie(e){return r("editor.insertAtCursor",e)}function se(e){return r("editor.dispatch",e)}function ae(e,t=""){return r("editor.prompt",e,t)}function ce(e){return r("editor.confirm",e)}function de(e){return r("editor.getUiOption",e)}function le(e,t){return r("editor.setUiOption",e,t)}function ue(){return r("editor.fold")}function pe(){return r("editor.unfold")}function me(){return r("editor.toggleFold")}function fe(){return r("editor.foldAll")}function ge(){return r("editor.unfoldAll")}function he(){return r("editor.undo")}function ye(){return r("editor.redo")}function xe(){return r("editor.openSearchPanel")}function ve(e){return r("editor.copyToClipboard",e)}function be(){return r("editor.deleteLine")}function we(e){return r("editor.vimEx",e)}var g={};f(g,{applyAttributeExtractors:()=>Ge,getEnv:()=>Fe,getMode:()=>Re,getSpaceConfig:()=>Se,getVersion:()=>Te,invokeCommand:()=>Ie,invokeFunction:()=>Pe,invokeSpaceFunction:()=>Me,listCommands:()=>Be,listSyscalls:()=>Ze,reloadConfig:()=>Ue,reloadPlugs:()=>We});function Pe(e,...t){return r("system.invokeFunction",e,...t)}function Ie(e,t){return r("system.invokeCommand",e,t)}function Be(){return r("system.listCommands")}function Ze(){return r("system.listSyscalls")}function Me(e,...t){return r("system.invokeSpaceFunction",e,...t)}function Ge(e,t,n){return r("system.applyAttributeExtractors",e,t,n)}async function Se(e,t){return await r("system.getSpaceConfig",e)??t}function We(){return r("system.reloadPlugs")}function Ue(){return r("system.reloadConfig")}function Fe(){return r("system.getEnv")}function Re(){return r("system.getMode")}function Te(){return r("system.getVersion")}var l={};f(l,{del:()=>Ke,get:()=>Le,set:()=>ke});function ke(e,t){return r("clientStore.set",e,t)}function Le(e){return r("clientStore.get",e)}function Ke(e){return r("clientStore.delete",e)}var m={};f(m,{readAsset:()=>Ne});function He(e){let t=atob(e),n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o}function C(e){let t=e.split(",",2)[1];return He(t)}async function Ne(e,t,n="utf8"){let o=await r("asset.readAsset",e,t);switch(n){case"utf8":return new TextDecoder().decode(C(o));case"dataurl":return o}}var _e=new TextEncoder;function et(e){let t=typeof e;return t!=="object"?t:e===null?"null":e?.constructor?.name??"object"}function u(e){if(typeof e=="string")return _e.encode(e);if(e instanceof Uint8Array)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new TypeError(`Cannot validate the input as it must be a Uint8Array, a string, or an ArrayBuffer: received a value of the type ${et(e)}`)}var tt="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),rt=[];tt.forEach((e,t)=>rt[e.charCodeAt(0)]=t);var Ot="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz".split("");var c=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function b(e){let t=u(e),n="",o,i=t.length;for(o=2;o<i;o+=3)n+=c[t[o-2]>>2],n+=c[(t[o-2]&3)<<4|t[o-1]>>4],n+=c[(t[o-1]&15)<<2|t[o]>>6],n+=c[t[o]&63];return o===i+1&&(n+=c[t[o-2]>>2],n+=c[(t[o-2]&3)<<4],n+="=="),o===i&&(n+=c[t[o-2]>>2],n+=c[(t[o-2]&3)<<4|t[o-1]>>4],n+=c[(t[o-1]&15)<<2],n+="="),n}var Dt=new TextEncoder().encode("0123456789abcdef"),Jt=new TextEncoder,Xt=new TextDecoder;var P=new ArrayBuffer(8),zt=new Uint32Array(P),$t=new BigUint64Array(P);async function h(){if(!await l.get("enableMindMapPreview"))return;let e=await a.getText(),t=b(e),n=await m.readAsset("markdown","assets/preview.css"),o=await m.readAsset("markdown","assets/preview.js"),i=`
loadJsByUrl("https://cdn.jsdelivr.net/npm/markmap-lib", "sha256-ulWyGiHbVRTYcTWQHIHT/r9sLSbO/4M6ZwoGj08JKcE=").then(() => {

  const { Transformer } = window.markmap;
  const transformer = new Transformer();
  const { root } = transformer.transform(atob("${t}"));
  loadJsByUrl("https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js", "sha256-8glLv2FBs1lyLE/kVOtsSw8OQswQzHr5IfwVj864ZTk=").then(() => {
    loadJsByUrl("https://cdn.jsdelivr.net/npm/markmap-view@0.18.4/dist/browser/index.js", "sha256-t0E4SeDTbZw4QNtQ/RqxPvK+wvw4oSYO1k4x0I1RKAE=").then(() => {
      ((getMarkmap, getOptions, root22, jsonOptions) => {
        const markmap = getMarkmap();
        window.mm = markmap.Markmap.create(
          "svg#mindmap",
          (getOptions || markmap.deriveOptions)(jsonOptions),
          root22
        );
      })(() => window.markmap, null, root, null)
    });
  });
});
  `,d=await a.getUiOption("customStyles"),s=ot();await a.showPanel("rhs",2,`
      <link rel="stylesheet" href="/.client/main.css" />
      <style>
        ${n}
        ${d??""}
        * {
          margin: 0;
          padding: 0;
        }
        #mindmap {
          display: block;
          width: 100vw;
          height: 100vh;
        }
      </style>
      <div id="root" class="sb-preview">${s}<svg id="mindmap"></svg></div>
    `,o+i)}function ot(){return`<div class="sb-mindmap-toolbar">
            <button onClick="window.print()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                  viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="feather feather-printer">
                <polyline points="6 9 6 2 18 2 18 9"/>
                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                <rect x="6" y="14" width="12" height="8"/>
              </svg>
            </button>
          </div>`}async function I(e){let[t,n]=JSON.parse(e);switch(t){case"pos":await a.moveCursor(+n,!0);break;case"command":await g.invokeCommand(n);break}}async function B(){let e=!!await l.get("enableMindMapPreview");await l.set("enableMindMapPreview",!e),e?await a.hidePanel("rhs"):await h()}var Z={toggle:B,preview:h,previewClickHandler:I},M={name:"mindmap",assets:{"assets/preview.js":{data:"data:application/javascript;base64,ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJvb3QiKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIChlKSA9PiB7CiAgLy8gY29uc29sZS5sb2coIkdvdCBjbGljayIsIGUudGFyZ2V0KQogIGNvbnN0IGRhdGFTZXQgPSBlLnRhcmdldC5kYXRhc2V0OwogIGlmIChkYXRhU2V0WyJvbmNsaWNrIl0pIHsKICAgIHN5c2NhbGwoImV2ZW50LmRpc3BhdGNoIiwgInByZXZpZXc6Y2xpY2siLCBkYXRhU2V0WyJvbmNsaWNrIl0pLmNhdGNoKChlKSA9PgogICAgICBjb25zb2xlLmxvZygiRXJyb3IiLCBlKQogICAgKTsKICB9IGVsc2UgaWYgKGRhdGFTZXRbInBvcyJdKSB7CiAgICBzeXNjYWxsKAogICAgICAiZXZlbnQuZGlzcGF0Y2giLAogICAgICAicHJldmlldzpjbGljayIsCiAgICAgIEpTT04uc3RyaW5naWZ5KFsicG9zIiwgZGF0YVNldFsicG9zIl1dKSwKICAgICkuY2F0Y2goKGUpID0+IGNvbnNvbGUubG9nKCJFcnJvciIsIGUpKTsKICB9Cn0pOwo=",mtime:1735570409079},"assets/preview.css":{data:"data:text/css;base64,aHRtbCwKaHRtbCB7CiAgb3ZlcmZsb3cteTogc2Nyb2xsICFpbXBvcnRhbnQ7CiAgd2lkdGg6IDkwJSAhaW1wb3J0YW50Owp9Cgpib2R5IHsKICBvdmVyZmxvdzogaW5pdGlhbCAhaW1wb3J0YW50OwogIGNvbG9yOiB2YXIoLS10b3AtY29sb3IpOwogIGZvbnQtZmFtaWx5OiBnZW9yZ2lhLCB0aW1lcywgc2VyaWY7CiAgZm9udC1zaXplOiAxNHB0OwogIG1heC13aWR0aDogODAwcHg7CiAgbWFyZ2luLWxlZnQ6IGF1dG87CiAgbWFyZ2luLXJpZ2h0OiBhdXRvOwogIG1hcmdpbi10b3A6IHJldmVydDsKICBtYXJnaW4tYm90dG9tOiByZXZlcnQ7CiAgcGFkZGluZy1sZWZ0OiAyMHB4OwogIHBhZGRpbmctcmlnaHQ6IDIwcHg7Cn0KCmltZyB7CiAgbWF4LXdpZHRoOiAxMDAlOwp9Cgp0YWJsZSB7CiAgd2lkdGg6IDEwMCU7CiAgYm9yZGVyLXNwYWNpbmc6IDA7Cn0KCnVsIGxpIHAgewogIG1hcmdpbjogMDsKfQoKdGhlYWQgdHIgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWVkaXRvci10YWJsZS1oZWFkLWJhY2tncm91bmQtY29sb3IpOwogIGNvbG9yOiB2YXIoLS1lZGl0b3ItdGFibGUtaGVhZC1jb2xvcik7Cn0KCnRoLAp0ZCB7CiAgcGFkZGluZzogOHB4Owp9Cgp0Ym9keSB0cjpudGgtb2YtdHlwZShldmVuKSB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tZWRpdG9yLXRhYmxlLWV2ZW4tYmFja2dyb3VuZC1jb2xvcik7Cn0KCmFbaHJlZl0gewogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICBjb2xvcjogdmFyKC0tbGluay1jb2xvcik7Cn0KCmJsb2NrcXVvdGUgewogIGJvcmRlci1sZWZ0OiAxcHggc29saWQgdmFyKC0tZWRpdG9yLWJsb2NrcXVvdGUtYm9yZGVyLWNvbG9yKTsKICBtYXJnaW4tbGVmdDogMnB4OwogIHBhZGRpbmctbGVmdDogMTBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1lZGl0b3ItYmxvY2txdW90ZS1iYWNrZ3JvdW5kLWNvbG9yKTsKICBjb2xvcjogdmFyKC0tZWRpdG9yLWJsb2NrcXVvdGUtY29sb3IpOwp9CgpociB7CiAgbWFyZ2luOiAxZW0gMCAxZW0gMDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1lZGl0b3ItcnVsZXItY29sb3IpOwogIGJvcmRlci13aWR0aDogMDsKICBib3JkZXItc3R5bGU6IGRvdHRlZDsKfQoKaHI6YWZ0ZXIgewogIGNvbnRlbnQ6ICLCt8K3wrciOwogIGxldHRlci1zcGFjaW5nOiAxZW07Cn0KCnNwYW4uaGlnaGxpZ2h0IHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1oaWdobGlnaHQtY29sb3IpOwp9Cg==",mtime:1735570409079}},functions:{toggle:{path:"./mindmap.ts:togglePreview",command:{name:"Mindmap Preview: Toggle",key:"Ctrl-m",mac:"Cmd-m"}},preview:{path:"./preview.ts:updateMindMapPreview",events:["plug:load","editor:updated","editor:pageLoaded","editor:pageReloaded"]},previewClickHandler:{path:"./preview.ts:previewClickHandler",events:["preview:click"]}}},yr={manifest:M,functionMapping:Z};w(Z,M,self.postMessage);export{yr as plug};
